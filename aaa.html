<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Game Store</title>

  <!-- Fonts + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>

  <!-- Styles -->
  <link rel="stylesheet" href="landing.css" />

  <style>
    /* === User menu (account card) === */
    .user-menu{ position:relative; display:none; }
    .user-btn{
      display:inline-flex; align-items:center; justify-content:center;
      width:44px; height:44px; border-radius:999px;
      background:#1a1a1a; border:1px solid #262626; color:#e8e8e8;
      font-size:1.4rem; cursor:pointer; transition:background .15s ease, color .15s ease;
    }
    .user-btn:hover{ background:#222; }
    .user-btn.logged-in { color: #00ff00; } /* green after login */

    .user-card{
      position:absolute; top:calc(100% + 10px); right:0; min-width:280px;
      background:#111; border:1px solid #222; border-radius:16px;
      box-shadow:0 18px 40px rgba(0,0,0,.5); padding:12px; display:none; z-index:4000;
    }
    .user-menu.open .user-card{ display:block; }

    .uc-header{
      display:flex; align-items:center; gap:12px;
      padding:12px; border-radius:12px; background:#151515; border:1px solid #222;
      margin-bottom:10px;
    }
    .uc-avatar{
      width:42px; height:42px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      background:#28a745; color:#fff; font-weight:800;
      transition: background .15s ease, color .15s ease;
    }
    .uc-avatar.logged-in { background: #00ff00; color:#111; } /* green avatar */
    
    .uc-ident{ line-height:1.2; }
    .uc-name{ font-weight:800; color:#fff; }
    .uc-points{ font-size:.85rem; color:#bdbdbd; }
    .uc-items{ padding:6px 0; }
    .uc-item{
      width:100%; display:flex; align-items:center; gap:10px;
      padding:10px 12px; color:#eaeaea; background:transparent; border:none;
      text-decoration:none; border-radius:10px; cursor:pointer; font-weight:700;
      transition:background .15s ease, color .15s ease, transform .05s ease;
    }
    .uc-item i{ font-size:1.1rem; }
    .uc-item:hover{ background:#1b1b1d; color:#fff; }
    .uc-logout{
      width:100%; text-align:left; margin-top:6px; color:#ff8080;
    }
    .uc-logout:hover{ background:#1b1b1d; color:#ffb3b3; }
  </style>
</head>
<body>

  <!-- ===== Top Header / Nav ===== -->
  <header class="topbar">
    <div class="topbar-row">
      <a href="landing.html" class="brand"><img src="Images/logo.png" alt="Brand Logo"></a>

      <form class="search" action="#" method="get">
        <input type="text" name="q" placeholder="Search" aria-label="Search games, consoles, accessories" />
        <button type="submit" aria-label="Search"><i class='bx bx-search'></i></button>
      </form>

      <div class="actions">
        <a href="redeem.html" class="redeem"><i class='bx bxs-hot'></i> <span>REDEEM</span></a>

        <!-- Login pill -->
        <a href="login.html" id="loginBtn" class="icon-btn" aria-label="Login">
          <i class='bx bx-user'></i><span class="label">Login</span>
        </a>

        <!-- User icon + dropdown -->
        <div class="user-menu" id="userMenu">
          <button class="user-btn" id="userBtn" aria-expanded="false" aria-haspopup="true">
            <i class='bx bx-user-circle'></i>
          </button>

          <div class="user-dropdown user-card" id="userDropdown" role="menu">
            <div class="uc-header">
              <div class="uc-avatar" id="userAvatar">U</div>
              <div class="uc-ident">
                <div class="uc-name" id="userNameLarge">User</div>
                <div class="uc-points" id="userPoints">0 Points</div>
              </div>
            </div>

            <div class="uc-items">
              <a href="profile.html" class="uc-item"><i class='bx bx-id-card'></i> Profile</a>
              <a href="orders.html" class="uc-item"><i class='bx bx-package'></i> Orders</a>
              <a href="mytickets.html" class="uc-item"><i class='bx bx-list-check'></i> My Tickets</a>
              <a href="tickets.html" class="uc-item"><i class='bx bx-support'></i> Need Help?</a>
            </div>

            <button class="uc-item uc-logout" id="logoutBtn"><i class='bx bx-log-out'></i> Logout</button>
          </div>
        </div>

        <a href="cart.html" class="icon-btn cart" aria-label="Cart">
          <i class='bx bx-cart'></i><span class="count" id="cartCount">0</span>
        </a>
      </div>
    </div>

    <!-- Global nav -->
    <nav class="mainnav" aria-label="Main navigation">
      <ul>
        <li><a href="#">HOME</a></li>
        <li class="has-sub">
          <button class="nav-link">CONSOLES <i class='bx bx-chevron-down'></i></button>
          <ul class="submenu">
              <li><a href="consoles.html?platform=PS">PS</a></li>
    <li><a href="consoles.html?platform=Xbox">Xbox</a></li>
    <li><a href="consoles.html?platform=Nintendo Switch">Nintendo</a></li>
            </ul>
        </li>
        <li class="has-sub">
          <button class="nav-link">GAMES<i class='bx bx-chevron-down'></i></button>
          <ul class="submenu">
    <li><a href="games.html?platform=PS5">PS5</a></li>
    <li><a href="games.html?platform=PS4">PS4</a></li>
    <li><a href="games.html?platform=Xbox">Xbox</a></li>
    <li><a href="games.html?platform=Nintendo%20Switch">Nintendo</a></li>
  </ul>
        </li>
        <li class="has-sub">
          <button class="nav-link">GAMING PERIPHERALS <i class='bx bx-chevron-down'></i></button>
          <ul class="submenu">
            <li><a href="items.html?category=peripherals&platform=kb">Keyboards</a></li>
            <li><a href="items.html?category=peripherals&platform=mice">Mice</a></li>
            <li><a href="items.html?category=peripherals&platform=monitor">Monitors</a></li>
          </ul>
        </li>
        <li class="has-sub">
          <button class="nav-link">TOYS & COLLECTIBLES <i class='bx bx-chevron-down'></i></button>
          <ul class="submenu">
            <li><a href="items.html?category=toys&platform=LE">Limited Editions</a></li>
            <li><a href="items.html?category=toys&platform=figures">Figures</a></li>
          </ul>
        </li>
        <li class="has-sub">
          <button class="nav-link">LIFE STYLE & MERCHANDISE <i class='bx bx-chevron-down'></i></button>
          <ul class="submenu">
            <li><a href="items.html?category=lifestyle&platform=apparel">Apparel</a></li>
            <li><a href="items.html?category=lifestyle&platform=bag">Bags</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </header>

  <!-- ===== Redeem Page Content ===== -->
<section class="redeem-page">
  <div class="container">
    <h2 class="redeem-title">Redeem Your Points</h2>
    <p class="redeem-subtitle">Use your points to get awesome rewards!</p>

    <div class="redeem-items">
      <div class="redeem-card">
        <img src="Images/giftcard.png" alt="Gift Card">
        <h3>Gift Card - RM10</h3>
        <p>100 Points</p>
        <button class="redeem-btn" data-points="100">Redeem</button>
      </div>

      <div class="redeem-card">
        <img src="Images/gamevoucher.png" alt="Game Voucher">
        <h3>Game Voucher</h3>
        <p>250 Points</p>
        <button class="redeem-btn" data-points="250">Redeem</button>
      </div>

      <div class="redeem-card">
        <img src="Images/merch.png" alt="Merchandise">
        <h3>Merchandise</h3>
        <p>500 Points</p>
        <button class="redeem-btn" data-points="500">Redeem</button>
      </div>
    </div>

    <p id="redeem-message"></p>
  </div>
</section>

<style>
.redeem-page {
  padding: 3rem 1rem;
  background: #0f0f0f;
  color: #eee;
  text-align: center;
}

.redeem-title {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.redeem-subtitle {
  font-size: 1.1rem;
  color: #aaa;
  margin-bottom: 2rem;
}

.redeem-items {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 2rem;
}

.redeem-card {
  background: #1a1a1a;
  border-radius: 16px;
  padding: 1.5rem 1rem;
  width: 250px;
  text-align: center;
  transition: transform 0.2s ease, background 0.2s ease;
}

.redeem-card:hover {
  transform: translateY(-5px);
  background: #222;
}

.redeem-card img {
  width: 100px;
  margin-bottom: 1rem;
}

.redeem-card h3 {
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  color: #fff;
}

.redeem-card p {
  font-size: 1rem;
  margin-bottom: 1rem;
  color: #bdbdbd;
}

.redeem-card button {
  background: #00ff00;
  border: none;
  border-radius: 8px;
  padding: 0.6rem 1.2rem;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.2s ease;
}

.redeem-card button:hover {
  background: #0f0;
}

#redeem-message {
  margin-top: 1.5rem;
  font-weight: 700;
  color: limegreen;
}
</style>




  




  <!-- Firebase + user points logic -->
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCnIL_Lg-sEQs-52YRUL9PTaWTWc4Xu5xA",
  authDomain: "final-year-b1cc2.firebaseapp.com",
  projectId: "final-year-b1cc2",
  storageBucket: "final-year-b1cc2.firebasestorage.app",
  messagingSenderId: "537245015385",
  appId: "1:537245015385:web:ab79c9ec5e2a74cc924048",
  measurementId: "G-V6SWSF6F2D"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginBtn   = document.getElementById("loginBtn");
const userMenu   = document.getElementById("userMenu");
const userBtn    = document.getElementById("userBtn");
const userNameLg = document.getElementById("userNameLarge");
const userPoints = document.getElementById("userPoints");
const userAvatar = document.getElementById("userAvatar");
const logoutBtn  = document.getElementById("logoutBtn");

function initialsFrom(nameOrEmail){
  const base = (nameOrEmail || "User").trim();
  const parts = base.includes("@") ? [base.split("@")[0]] : base.split(" ");
  const letters = parts.filter(Boolean).slice(0,2).map(s => s[0].toUpperCase());
  return letters.join('') || 'U';
}

function showLoggedInDisplay(name, points, email){
  if(loginBtn) loginBtn.style.display = "none";
  if(userMenu) userMenu.style.display = "inline-flex";
  if(userNameLg) userNameLg.textContent = name || "User";
  if(userPoints) userPoints.textContent = `${points || 0} Points`;
  if(userAvatar){
    userAvatar.textContent = initialsFrom(email || name);
    userAvatar.classList.add('logged-in'); // green avatar
  }
  if(userBtn) userBtn.classList.add('logged-in'); // green button
}

function showLoggedOutDisplay(){
  if(loginBtn) loginBtn.style.display = "inline-flex";
  if(userMenu) userMenu.style.display = "none";
  if(userAvatar) userAvatar.classList.remove('logged-in');
  if(userBtn) userBtn.classList.remove('logged-in');
}


// Instant display if stored in localStorage
let name = localStorage.getItem("name");
let points = localStorage.getItem("points");
if (name) showLoggedInDisplay(name, points);

onAuthStateChanged(auth, async (user) => {
  if (user) {
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);

    if (!userSnap.exists()) {
      // Create user record if not found
      await setDoc(userRef, {
        name: user.displayName || user.email.split("@")[0],
        email: user.email,
        phone: "",
        points: 0
      });
    }

    const userData = (await getDoc(userRef)).data();

    // Store in localStorage
    localStorage.setItem("name", userData.name);
    localStorage.setItem("points", userData.points);

    // Display user's full name
    showLoggedInDisplay(userData.name, userData.points);
  } else {
    localStorage.removeItem("name");
    localStorage.removeItem("points");
    showLoggedOutDisplay();
  }
});


// Toggle dropdown
if (userBtn && userMenu){
  userBtn.addEventListener("click", e=>{
    e.stopPropagation();
    const isOpen = userMenu.classList.toggle("open");
    userBtn.setAttribute("aria-expanded", String(isOpen));
  });
  document.addEventListener("click", e=>{
    if (!userMenu.contains(e.target)){
      userMenu.classList.remove("open");
      userBtn.setAttribute("aria-expanded","false");
    }
  });
  document.addEventListener("keydown", e=>{
    if (e.key === "Escape"){
      userMenu.classList.remove("open");
      userBtn.setAttribute("aria-expanded","false");
    }
  });
}

// Logout
if (logoutBtn){
  logoutBtn.addEventListener("click", async ()=>{
    try { await signOut(auth); } catch {}
    localStorage.removeItem("username");
    localStorage.removeItem("points");
    showLoggedOutDisplay();
    window.location.href = "landing.html";
  });
}
</script>

<!-- üü¢ Load game details dynamically from Firestore -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Same Firebase config ...
  const firebaseConfig = {
    apiKey: "AIzaSyCnIL_Lg-sEQs-52YRUL9PTaWTWc4Xu5xA",
    ...
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Get game ID from URL
  ...
  async function loadGameDetails() {
    ...
  }
  loadGameDetails();
</script>


<!-- üõí Add to Cart Functionality -->
<script type="module">
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, increment, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Reuse Firebase app already initialized above
  const auth = getAuth();
  const db = getFirestore();

  const addToCartBtn = document.querySelector(".add-to-cart");
  const qtyInput = document.getElementById("qty");

  // Get game info from page
  const gameTitle = document.querySelector(".game-info h2");
  const gamePrice = document.querySelector(".game-info .price");
  const gameCover = document.querySelector(".game-cover img");

  addToCartBtn.addEventListener("click", async () => {
    const user = auth.currentUser;

    if (!user) {
      alert("Please log in to add items to your cart.");
      window.location.href = "login.html";
      return;
    }

    const uid = user.uid;
    const gameId = new URLSearchParams(window.location.search).get("id");
    const quantity = parseInt(qtyInput.value) || 1;

    // Prepare cart item data
    const itemData = {
      title: gameTitle.textContent,
      price: parseFloat(gamePrice.textContent.replace(/[^\d.]/g, "")) || 0,
      image: gameCover.src,
      quantity: quantity,
      addedAt: new Date()
    };

    const cartItemRef = doc(db, "users", uid, "cart", gameId);
    const existingSnap = await getDoc(cartItemRef);

    try {
      if (existingSnap.exists()) {
        // Update quantity if item already exists
        await updateDoc(cartItemRef, {
          quantity: increment(quantity)
        });
      } else {
        // Create new cart item
        await setDoc(cartItemRef, itemData);
      }
      alert("‚úÖ Added to cart!");
    } catch (error) {
      console.error("Error adding to cart:", error);
      alert("‚ùå Failed to add item to cart.");
    }
  });
</script>

<!-- Firebase + user menu + points -->
<script type="module">
  // ... your existing Firebase login/logout logic ...
</script>

<!-- ‚úÖ Add this below -->
<!-- üîÅ Real-time Cart Count Sync (Keeps last value after logout) -->
<script type="module">
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const auth = getAuth();
  const db = getFirestore();
  const cartCountEl = document.getElementById("cartCount");

  function updateCartCount(count) {
    if (cartCountEl) {
      cartCountEl.textContent = count;
    }
    localStorage.setItem("cartCount", count);
  }

  const savedCount = localStorage.getItem("cartCount");
  if (savedCount !== null) {
    updateCartCount(savedCount);
  }

  // Auth state
    onAuthStateChanged(auth, (user) => {
      if (user) {
        showLoggedIn(user.email);
        renderCart(user.uid);
        updateCartCount(user.uid);

        // üü¢ Show cart bubble when logged in
    cartCountEl.style.display = "inline-flex";
    
      } else {
        showLoggedOut();
        cartContainer.innerHTML = `<p>Please log in to view your cart.</p>`;
      }
    });
</script>

<!-- ‚úÖ Hide cart bubble when logged out / Show when logged in -->
<script type="module">
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const auth = getAuth();
  const db = getFirestore();
  const cartCountEl = document.getElementById("cartCount");

  function updateCartCount(count) {
    if (cartCountEl) {
      cartCountEl.textContent = count;
      // hide if zero
      cartCountEl.style.display = count > 0 ? "inline-flex" : "none";
    }
    localStorage.setItem("cartCount", count);
  }

  // Load saved count from localStorage (for smooth transitions)
  const savedCount = localStorage.getItem("cartCount");
  if (savedCount !== null) {
    updateCartCount(Number(savedCount));
  }

  // Monitor auth state
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // üü¢ User logged in ‚Äî listen to Firestore cart
      const cartRef = collection(db, "users", user.uid, "cart");
      onSnapshot(cartRef, (snapshot) => {
        const itemCount = snapshot.docs.reduce((sum, doc) => sum + (doc.data().quantity || 0), 0);
        updateCartCount(itemCount);
      });
    } else {
      // üî¥ Logged out ‚Äî hide bubble + clear local storage
      localStorage.removeItem("cartCount");
      if (cartCountEl) {
        cartCountEl.style.display = "none";
      }
    }
  });
</script>

<script src="landing.js?v=10"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ‚úÖ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCnIL_Lg-sEQs-52YRUL9PTaWTWc4Xu5xA",
    authDomain: "final-year-b1cc2.firebaseapp.com",
    projectId: "final-year-b1cc2",
    storageBucket: "final-year-b1cc2.firebasestorage.app",
    messagingSenderId: "537245015385",
    appId: "1:537245015385:web:ab79c9ec5e2a74cc924048",
    measurementId: "G-V6SWSF6F2D"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const slidesContainer = document.getElementById("bannerSlides");
  const prevBtn = document.querySelector(".banner-slider .prev");
  const nextBtn = document.querySelector(".banner-slider .next");
  const dotsContainer = document.getElementById("bannerDots");

  let currentIndex = 0;
  let totalSlides = 0;
  let autoSlideInterval;

  async function loadBanners() {
    const q = query(collection(db, "banners"), orderBy("order"));
    const snapshot = await getDocs(q);

    slidesContainer.innerHTML = "";
    dotsContainer.innerHTML = "";

    snapshot.forEach((doc, i) => {
      const data = doc.data();

      // Create slide
      const slide = document.createElement("div");
      slide.classList.add("slide");
      slide.innerHTML = `<img src="${data.imageURL}" alt="${data.alt || "Banner"}" />`;
      slidesContainer.appendChild(slide);

      // Create dot
      const dot = document.createElement("div");
      dot.classList.add("dot");
      dot.dataset.index = i;
      dotsContainer.appendChild(dot);
    });

    totalSlides = snapshot.size;
    currentIndex = 0;
    updateSlidePosition();
    updateDots();
    startAutoSlide();

    // Dot click handler
    dotsContainer.querySelectorAll(".dot").forEach(dot => {
      dot.addEventListener("click", () => {
        currentIndex = parseInt(dot.dataset.index);
        updateSlidePosition();
        updateDots();
        resetAutoSlide();
      });
    });
  }

  // üîÅ Move slide
  function updateSlidePosition() {
    slidesContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
    slidesContainer.style.transition = "transform 0.5s ease";
    updateDots();
  }

  function updateDots() {
    document.querySelectorAll(".dot").forEach((dot, i) => {
      dot.classList.toggle("active", i === currentIndex);
    });
  }

  function showPrev() {
    if (totalSlides <= 1) return;
    currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
    updateSlidePosition();
    resetAutoSlide();
  }

  function showNext() {
    if (totalSlides <= 1) return;
    currentIndex = (currentIndex + 1) % totalSlides;
    updateSlidePosition();
    resetAutoSlide();
  }

  prevBtn.addEventListener("click", showPrev);
  nextBtn.addEventListener("click", showNext);

  // üïì Auto-slide logic
  function startAutoSlide() {
    stopAutoSlide();
    autoSlideInterval = setInterval(showNext, 5000);
  }

  function stopAutoSlide() {
    if (autoSlideInterval) clearInterval(autoSlideInterval);
  }

  function resetAutoSlide() {
    stopAutoSlide();
    startAutoSlide();
  }

  loadBanners();
</script>



</body>
</html>
